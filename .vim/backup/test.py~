#!/usr/bin/python
from multiprocessing import Pool, Lock, Value
import os, time, random
from pymongo import MongoClient
import random
import string
from datetime import datetime

guid_count=200000000
lock = Lock()
counter = Value('i', 0)



def id_generator(size=64, chars=string.ascii_letters + string.digits):
    return ''.join(random.choice(chars) for _ in range(size))

def insert(fn):
    db = MongoClient("10.110.32.46", replicaset='charge_gift').notify
    db.authenticate("notify_w", "notify_w")
    global guid_count, lock, counter
    with lock:
        counter.value += 1
        token = id_generator()
        user=random.randint(100,200000000)
        db.profile.insert({'guid':counter.value,'token':token,'plat':'ios','user':user,'ttl':datetime.utcnow()})


if __name__=='__main__':
    p = Pool(16)
    p.map(insert,xrange(100000))
    p.close()
    p.join()

