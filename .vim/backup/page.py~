#!/usr/bin/python
import unpack_byte
import struct

table_file = '/opt/mysql-5.7/page_std/data/test/a1.ibd'

with open(table_file, 'rb') as f:
    all = f.read()

buf = buffer(all)

FIL_PAGE_TYPE_MAP = {
    17855: "FIL_PAGE_INDEX",
    17854: "FIL_PAGE_RTREE",
    2: "FIL_PAGE_UNDO_LOG",
    3: "FIL_PAGE_INODE",
    4: "FIL_PAGE_IBUF_FREE_LIST",
    0: "FIL_PAGE_TYPE_ALLOCATED",
    5: "FIL_PAGE_IBUF_BITMAP",
    6: "FIL_PAGE_TYPE_SYS",
    7: "FIL_PAGE_TYPE_TRX_SYS",
    8: "FIL_PAGE_TYPE_FSP_HDR",
    9: "FIL_PAGE_TYPE_XDES",
    10: "FIL_PAGE_TYPE_BLOB",
    11: "FIL_PAGE_TYPE_ZBLOB",
    12: "FIL_PAGE_TYPE_ZBLOB2",
    13: "FIL_PAGE_TYPE_UNKNOWN",
    14: "FIL_PAGE_COMPRESSED",
    15: "FIL_PAGE_ENCRYPTED",
    16: "FIL_PAGE_COMPRESSED_AND_ENCRYPTED",
    17: "FIL_PAGE_ENCRYPTED_RTREE"
}


parse_Byte = unpack_byte.Parse_Byte_Stream(buf)

FIL_PAGE_SPACE_OR_CHKSUM = hex(parse_Byte.get_uint32())
FIL_PAGE_OFFSET = hex(parse_Byte.get_uint32())
FIL_PAGE_PREV = hex(parse_Byte.get_uint32())
FIL_PAGE_NEXT = hex(parse_Byte.get_uint32())
FIL_PAGE_LSN = parse_Byte.get_uint64()
FIL_PAGE_TYPE = parse_Byte.get_uint16()
FIL_PAGE_FILE_FLUSH_LSN = hex(parse_Byte.get_uint64())
FIL_PAGE_ARCH_LOG_NO = hex(parse_Byte.get_uint32())

PAGE_N_DIR_SLOTS = hex(parse_Byte.get_uint16())
PAGE_HEAP_TOP = hex(parse_Byte.get_uint16())
PAGE_N_HEAP = hex(parse_Byte.get_uint16())
PAGE_FREE = hex(parse_Byte.get_uint16())
PAGE_GARBAGE = parse_Byte.get_uint16()
PAGE_LAST_INSERT = hex(parse_Byte.get_uint16())
PAGE_DIRECTION = hex(parse_Byte.get_uint16())
PAGE_N_DIRECTION = hex(parse_Byte.get_uint16())
PAGE_N_RECS = parse_Byte.get_uint16()
PAGE_MAX_TRX_ID = parse_Byte.get_uint64()
''' PAGE_HEADER_PRIV_END '''

print "FIL_PAGE_SPACE_OR_CHKSUM", FIL_PAGE_SPACE_OR_CHKSUM
print "FIL_PAGE_OFFSET", FIL_PAGE_OFFSET
print "FIL_PAGE_PREV", FIL_PAGE_PREV
print "FIL_PAGE_NEXT", FIL_PAGE_NEXT
print "FIL_PAGE_LSN", FIL_PAGE_LSN
print "FIL_PAGE_TYPE", FIL_PAGE_TYPE_MAP[FIL_PAGE_TYPE]
print "FIL_PAGE_FILE_FLUSH_LSN", FIL_PAGE_FILE_FLUSH_LSN
print "FIL_PAGE_ARCH_LOG_NO", FIL_PAGE_ARCH_LOG_NO
print "-------------------------------------"

print "PAGE_N_DIR_SLOTS", PAGE_N_DIR_SLOTS
print "PAGE_HEAP_TOP", PAGE_HEAP_TOP
print "PAGE_FREE", PAGE_FREE
print "PAGE_GARBAGE", PAGE_GARBAGE
print "PAGE_LAST_INSERT", PAGE_LAST_INSERT
print "PAGE_DIRECTION", PAGE_DIRECTION
print "PAGE_N_DIRECTION", PAGE_N_DIRECTION
print "PAGE_N_RECS", PAGE_N_RECS
print "PAGE_MAX_TRX_ID", PAGE_MAX_TRX_ID
