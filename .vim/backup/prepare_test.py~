#!/usr/bin/python2
import MySQLdb

conn = MySQLdb.connect(host='127.0.0.1',port=3306,user='root',passwd='123',db="test",charset="utf8")  
cursor = conn.cursor()
try:
    cursor.execute("drop table if exists t_parent")
    cursor.execute("set @save_table_definition_cache=@@global.table_definition_cache;")
    cursor.execute("set @save_table_open_cache=@@global.table_open_cache;")
    cursor.execute("set @@global.table_open_cache=400;")
    cursor.execute("set @@global.table_definition_cache=400;")
    for i in range(400):
        n = cursor.execute("drop table if exists t" + str(i))
        n = cursor.execute("create table t" + str(i) + " (a int)engine=myisam")
        n = cursor.execute("set @a=ifnull(concat(@a, ', ', 't" + str(i) + "'), 't" + str(i) + "')")
    
    
    cursor.execute("set @a=concat('create table t_parent (a int) union(', @a,') insert_method=first engine=mrg_myisam')")
    cursor.execute("prepare stmt from @a")
    cursor.execute("execute stmt;")
    cursor.execute("prepare stmt from 'select * from t_parent'")
    cursor.execute("execute stmt;")
except MySQLdb.Error as reason:
    print reason
cursor.execute("set @@global.table_definition_cache=@save_table_definition_cache;")
cursor.execute("set @@global.table_open_cache=@save_table_open_cache;")

for i in range(400):
    n = cursor.execute("drop table t" + str(i))
    
cursor.execute("drop table t_parent")
cursor.close()

#    "drop table if exists t$1;"
#    "create table t$i (c1 int)engine=myisam"
#    "set @a=ifnull(concat(@a, ", ", "t$1"), "t$1");"
