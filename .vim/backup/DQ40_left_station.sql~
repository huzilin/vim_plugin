DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `DQ40_left_station`(IN `train_date_in` char(8),IN `purpose_code_in` char(255),IN `start_station_telecode_in` char(3),IN `to_station_telecode_in` char(3),IN `office_no_in` char(7),IN `window_no_in` tinyint unsigned,IN `query_right_in` char(1),IN `flag_in` tinyint unsigned,IN `range_in` tinyint unsigned,IN `inner_code_in` char(3),IN `show_flag_in` tinyint unsigned,OUT `return_out` integer)
BEGIN
	DECLARE l_Version CHAR(20)                                                                                                                                                                                             
	;DECLARE  l_current_date   CHAR(8)     ;DECLARE  l_day_diff   SMALLINT
	 ;DECLARE  l_max_day    SMALLINT     ;DECLARE  l_train_no   CHAR(12)
	 ;DECLARE  l_start_time   CHAR(4)     ;DECLARE  l_start_datetime DATETIME
	 ;DECLARE  l_overtime   SMALLINT     ;DECLARE  l_d1     DATETIME
	 ;DECLARE  l_d2     DATETIME     ;DECLARE  l_SQL     VARCHAR(1200)
	 ;DECLARE  l_my_center_code CHAR(2)     ;DECLARE  l_location_code  CHAR(2)
	 ;DECLARE  l_ticket_center_code CHAR(2)    ;DECLARE  l_rowcount   SMALLINT
	 ;DECLARE  l_error    SMALLINT     ;DECLARE  l_train_code   CHAR(12)
	 ;DECLARE  l_start_telecode CHAR(3)     ;DECLARE  l_end_telecode  CHAR(3)
	 ;DECLARE  l_start_bureau_code CHAR(1)    ;DECLARE  l_station_telecode  CHAR(3)
	 ;DECLARE  l_start_city_code  CHAR(4)    ;DECLARE  l_end_city_code   CHAR(4)
	 ;DECLARE  l_start_tele_list  VARCHAR(100)   ;DECLARE  l_end_tele_list   VARCHAR(100)
	 ;DECLARE   l_left_new    tinyint unsigned    ;DECLARE  l_share_train_flag  INT
	 ;DECLARE  l_station_train_code CHAR(8)    ;DECLARE  l_from_station_name CHAR(10)
	 ;DECLARE  l_to_station_name  CHAR(10)    ;DECLARE  l_to_station_no   CHAR(2)
	 ;DECLARE  l_end_start_time  CHAR(4)    ;DECLARE  l_end_arrive_time  CHAR(4)
	 ;DECLARE  l_start_day_difference tinyint unsigned    ;DECLARE  l_end_day_difference tinyint unsigned
	 ;DECLARE  l_start_date     CHAR(8)    ;DECLARE  l_date_after    INTEGER
	 ;DECLARE  l_running_style    INTEGER    ;DECLARE  l_running_rule   INTEGER
	 ;DECLARE  l_start_station_no   CHAR(2)    ;DECLARE  l_same_city    tinyint unsigned
	 ;DECLARE  l_station_name   CHAR(10)	;DECLARE lab_lab1_s INTEGER;DECLARE l_return_code INTEGER;DECLARE l_end_station_telecode char(3);
	Declare record_not_found Integer Default 0;
DECLARE i int;

declare proc_stat_start datetime;
   declare proc_stat_end datetime;
   declare proc_stat_time_diff int;
   declare open_statistics varchar(20);

	 DECLARE cursor_board_station CURSOR FOR 
		SELECT DISTINCT station_telecode,station_name FROM basic.station_divide_dictionary
		 WHERE city_code = l_start_city_code
			AND start_date <= train_date_in
			AND stop_date  >= train_date_in;

	 DECLARE cursor_end_station CURSOR FOR 
		SELECT DISTINCT station_telecode,station_name FROM basic.station_divide_dictionary
		 WHERE city_code = l_end_city_code
			AND start_date <= train_date_in
			AND stop_date  >= train_date_in;

	Declare Continue handler For Sqlstate '02000' Set record_not_found = 1;

select parameter_value into open_statistics from arith.parameters where parameter_code='open_statistics';
if open_statistics='1' then
	set proc_stat_start = now();
end if;

	CREATE Temporary TABLE If Not Exists temp_train_info_station ( 
		train_no     CHAR(12) NOT NULL
	 , start_time     CHAR(4) NOT NULL 
	 , start_telecode   CHAR(3) NOT NULL
	 , start_bureau_code  CHAR(1) NOT NULL
	 , start_station_no  CHAR(2) NOT NULL
	 , end_telecode    CHAR(3) NOT NULL
	 , end_start_time   CHAR(4) NOT NULL
	 , end_arrive_time  CHAR(4) NOT NULL
	 , start_day_difference tinyint unsigned NOT NULL
	 , end_day_difference tinyint unsigned NOT NULL
	 , station_train_code CHAR(8) NOT NULL
	 , from_station   CHAR(10) NOT NULL
	 , to_station    CHAR(10) NOT NULL
	 , from_station_no  CHAR(2) NOT NULL
	 , to_station_no   CHAR(2) NOT NULL
	 , day_diff     tinyint unsigned NOT NULL
	 , flag      tinyint unsigned NOT NULL
	 );
   Truncate Table  temp_train_info_station;                
	

	CREATE Temporary TABLE If Not Exists train_info_station
	 (train_date   CHAR(8) NOT NULL,
		train_no   CHAR(12) NOT NULL,
		train_code   CHAR(8) NOT NULL,
		from_station  CHAR(10) NOT NULL,
		to_station   CHAR(10) NOT NULL
		);
   Truncate Table  train_info_station;  


	CREATE Temporary TABLE If Not Exists tmp_ticket_left_station
	 (assign_station   char(10) NOT NULL,
		train_no     char(12) NOT NULL,
		train_date     char(8) NOT NULL,
		station_no    char(2) NOT NULL,
		far_from_station_no char(2) NOT NULL,
		limit_station   char(2) NOT NULL,
		coach_no     char(2) NOT NULL,
		seat_type_code   char(1) NOT NULL,
		purpose_code   char(2) NOT NULL,
		ticket_quantity  int NOT NULL,
		up_quantity    int NOT NULL,
		mid_quantity   int NOT NULL,
		down_quantity   int NOT NULL,
		ticket_source char(1) NOT NULL,
		l_range tinyint(3) unsigned NOT NULL,
		inner_code char(7) NOT NULL,
		wseat_type_code char(1) NOT NULL,
		seat_feature char(1) NOT NULL
		);
   Truncate Table  tmp_ticket_left_station;  

	CREATE Temporary TABLE If Not Exists temp_left_base_center_station
	( train_no     char(12) NULL,
		train_date     char(8) NULL,
		station_train_code char(8)NULL,
		station_no    char(2) NULL,
		assign_station   char(10),
		far_from_station_no char(2) NULL,
		limit_station   char(2) NULL,
		coach_no     char(2) NULL,
		seat_type_code   char(1) NULL,
		purpose_code   char(2) NULL,
		up_quantity    int NULL,
		mid_quantity   int NULL,
		down_quantity   int NULL,
		ticket_quantity  int NULL,
		wseat_type_code  char(1) NULL,
		seat_feature   char(1) NULL,
		seat_type_name   char(10) NULL,
		purpose_name   char(8) NULL,
		share_flag    tinyint unsigned NULL ,
		day_diff    tinyint unsigned NULL ,
		start_time   CHAR(4) NULL ,
		arrive_time     CHAR(4) NULL ,
		from_station   CHAR(10) NULL,
		to_station   CHAR(10) NULL,
		to_station_no  CHAR(2) NULL
	);
   Truncate Table temp_left_base_center_station;  
	

	CREATE Temporary TABLE If Not Exists temp_left_station
	( train_no char(12) NULL,
		train_date  char(8) NULL,
		 start_time  char(4) NULL,
	 station_train_code char(8)NULL,
	 station_no char(2) NULL,
		 assign char(10) NULL,
	 far_from_station_no char(2) NULL,
	 far_from_station_name char(10) NULL,
	 limit_station_name char(10) NULL,
	 limit_station char(2) NULL,
	 coach_no char(2) NULL,
		 seat_type_code char(1) NULL,        
	 seat_type_name char(10) NULL,
	 purpose_name char(8) NULL,
		 up_quantity int NULL,
		 mid_quantity int NULL,
		 down_quantity int NULL,
	 ticket_quantity int NULL,
	 coach_num int NULL,
	 arrive_time CHAR(4) NULL,                             
	 share_flag tinyint unsigned NULL                           
	, day_difference tinyint unsigned NULL                              
	, seat_feature CHAR(1) NULL                              
	, from_station CHAR(10) NULL
	, to_station  CHAR(10) NULL 
	, to_station_no CHAR(2) NULL
	);
   Truncate Table temp_left_station;  
	

	Set Transaction Isolation Level Read uncommitted;
															 
	SET l_Version = "20131231.12:10" ;
	SET l_d1 = now();
	SET l_left_new = 1;
	SET l_current_date = CURDATE()+0;

	If office_no_in Is Null Then
		 Set office_no_in = '';
	End If;

	If query_right_in Is Null Then
		 Set query_right_in = '1';
	End If;

	If flag_in Is Null Then
		 Set flag_in = 0;
	End If;

	If range_in Is Null Then
		 Set range_in = 0;
	End If;

	If inner_code_in Is Null Then
		 Set inner_code_in = '';
	End If;

	If show_flag_in Is Null Then
		 Set show_flag_in = 0;
	End If;

	set lab_lab1_s = 1;
	lab_lab1:loop
	if lab_lab1_s = 0 THEN
			leave lab_lab1;
	end if;

																																																																			
	SELECT city_code,station_name INTO l_start_city_code,l_from_station_name FROM basic.station_dictionary 
	 WHERE station_telecode = start_station_telecode_in
	 AND start_date <= train_date_in
	 AND stop_date >= train_date_in;

	IF row_count() = 0 THEN SET l_start_city_code = ''; end if;

	SELECT city_code,station_name INTO l_end_city_code,l_to_station_name FROM basic.station_dictionary 
	 WHERE station_telecode = to_station_telecode_in
	 AND start_date <= train_date_in
	 AND stop_date >= train_date_in;
	IF row_count() = 0 THEN SET l_end_city_code = ''; end if;

																			
	IF l_start_city_code = l_end_city_code THEN 
			SET l_same_city = 1;
	ELSE 
			SET l_same_city = 0;
	end if;
													
	IF EXISTS(SELECT 1 FROM basic.station_divide_dictionary WHERE city_code = l_start_city_code AND station_telecode = start_station_telecode_in) THEN
		 SET l_start_tele_list = '';
			 
		 OPEN cursor_board_station;
		 
		 lab_board_station:
		 WHILE 1 = 1 DO
				FETCH cursor_board_station INTO l_station_telecode,l_station_name;

				if record_not_found = 1 THEN
						leave lab_board_station;
				end IF;
																																														 
				IF l_same_city = 1 AND NOT (instr(ltrim(rtrim(l_from_station_name)),rtrim(ltrim(l_station_name))) > 0 OR instr(ltrim(rtrim(l_station_name)),rtrim(ltrim(l_from_station_name))) > 0 ) THEN
						ITERATE lab_board_station;
				end if;
				
				IF l_start_tele_list = '' THEN
						SET l_start_tele_list = concat('"', l_station_telecode , '"');
				ELSE 
						SET l_start_tele_list = concat(rtrim(l_start_tele_list) , ',' , '"' , l_station_telecode , '"');
				end if;
		 END WHILE lab_board_station;
		 CLOSE cursor_board_station;

		 IF l_start_tele_list = '' THEN SET l_start_tele_list = concat('"', start_station_telecode_in , '"'); end if;
	ELSE
			SET l_start_tele_list = concat('"' , start_station_telecode_in , '"');
	END if;



															
	IF EXISTS(SELECT 1 FROM basic.station_divide_dictionary WHERE city_code = l_end_city_code AND station_telecode = to_station_telecode_in) THEN
		 SET l_end_tele_list = '';
			 
		 OPEN cursor_end_station;
		 
		 lab_end_station:
		 WHILE 1 = 1 DO 
				FETCH cursor_end_station INTO l_station_telecode,l_station_name;

				if record_not_found = 1 THEN
						leave lab_end_station;
				end IF;
																																													 
				IF l_same_city = 1 AND NOT (instr(ltrim(rtrim(l_to_station_name)),rtrim(ltrim(l_station_name))) > 0 OR instr(ltrim(rtrim(l_station_name)),rtrim(ltrim(l_to_station_name))) > 0) THEN
						ITERATE lab_end_station;
				end if;

				IF l_end_tele_list = '' THEN 
						SET l_end_tele_list = concat('"' , l_station_telecode , '"');
				ELSE 
						SET l_end_tele_list = concat(rtrim(l_end_tele_list) , ',' , '"' , l_station_telecode , '"');
				END if;
		 end WHILE lab_end_station;
		 CLOSE cursor_end_station;

		 IF l_end_tele_list = '' THEN SET l_end_tele_list = concat('"' ,  to_station_telecode_in , '"'); end if;
	ELSE 
			SET l_end_tele_list = concat('"' ,  to_station_telecode_in , '"');
	END if;
																																																																					

									
	SET @l_SQL = concat(' INSERT INTO temp_train_info_station '
		, ' SELECT DISTINCT a.train_no,a.start_time,a.station_telecode,a.bureau_code,a.station_no'
		, ' ,b.station_telecode,b.start_time,b.arrive_time,a.day_difference,b.day_difference,a.station_train_code'
		, ' ,a.station_name,b.station_name,a.station_no,b.station_no,0,0'
		, ' FROM basic.stop_time a ,basic.stop_time b  '
		, '  WHERE a.start_date   <= date_format(date_add("' , train_date_in , '",INTERVAL - a.day_difference day),"%Y%m%d")'
		, '  AND a.stop_date   >= date_format(date_add("' , train_date_in , '",INTERVAL - a.day_difference day),"%Y%m%d")'
		, '   AND a.train_no    = b.train_no '
		, '  AND a.station_telecode  IN (' , l_start_tele_list , ')'
		, '  AND b.station_telecode  IN (' , l_end_tele_list , ')'
		, '   AND a.station_no   < b.station_no '
		, '  AND a.station_name  NOT LIKE "%*%"'
		, '  AND b.station_name  NOT LIKE "%*%"');



	prepare stmt_1 from @l_SQL;
	EXECUTE stmt_1;

	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_rowcount = 0 OR l_error != 0 THEN LEAVE lab_lab1; end if;                                 

																												 
	SET l_overtime = -10;

	lab_train_info_station:
	WHILE EXISTS(SELECT 1 FROM temp_train_info_station WHERE flag = 0 ) DO
			 SELECT train_no 
				, start_time 
				, start_telecode
				, start_station_no
				, end_telecode
				, start_bureau_code 
				, station_train_code
				, end_start_time
				, end_arrive_time
				, start_day_difference
				, end_day_difference
				, to_station_no
				, from_station
				, to_station
				INTO l_train_no,l_start_time,l_start_telecode,l_start_station_no,l_end_telecode,l_start_bureau_code,l_station_train_code,l_end_start_time,
				l_end_arrive_time,l_start_day_difference,l_end_day_difference,l_to_station_no,l_from_station_name,l_to_station_name
				FROM temp_train_info_station
				 WHERE flag = 0 LIMIT 1;
			 UPDATE temp_train_info_station SET flag = 1 WHERE train_no = l_train_no AND flag = 0;

																					 
			 IF train_date_in = l_current_date THEN
					SET l_start_datetime = str_to_date( concat(train_date_in ,l_start_time) ,'%Y%m%d%H%i');
																						
					IF timediff( l_start_datetime,now() ) <= l_overtime THEN
						 DELETE FROM temp_train_info_station WHERE train_no = l_train_no;
						 ITERATE lab_train_info_station; 
					END if;
			 END if;

			 SET l_train_code = l_train_no;
			 CALL arith.CS50_Get_Train_Parameter(l_train_code,start_station_telecode_in,l_end_station_telecode,l_return_code);
			 
			 SELECT start_date                                    
				,  running_style
				,  running_rule
				INTO l_start_date,l_running_style,l_running_rule
				FROM basic.train_dir 
				WHERE train_code    = l_train_code
				 AND subbureau_code = substring(l_train_no,1,2)
				 AND double_id    = substring(l_train_no,11,1)
				 AND schema_id    = substring(l_train_no,12,1);

			 set l_error =  @@error_count,l_rowcount = row_count();
			 IF l_rowcount != 1 OR l_error != 0 THEN ITERATE lab_train_info_station; END if; 
																					
			 IF l_running_style != 1 THEN
					SET l_date_after = datediff(train_date_in,l_start_date) - l_start_day_difference;
					SET l_date_after = l_date_after % l_running_style;
					IF l_running_rule & power(2,l_date_after) = 0 THEN ITERATE lab_train_info_station; END if; 
			 END if;

																								
			 IF EXISTS(SELECT 1 FROM temp_train_info_station WHERE train_no = l_train_no AND start_telecode = start_station_telecode_in) THEN
					DELETE FROM temp_train_info_station WHERE train_no = l_train_no AND start_telecode != start_station_telecode_in;
					IF l_start_telecode != start_station_telecode_in THEN  ITERATE lab_train_info_station; END if;                                   
					SET l_start_telecode = start_station_telecode_in;
			 END IF;
			 IF EXISTS(SELECT 1 FROM temp_train_info_station WHERE train_no = l_train_no AND end_telecode = to_station_telecode_in) THEN
					DELETE FROM temp_train_info_station WHERE train_no = l_train_no AND end_telecode != to_station_telecode_in;
					IF l_end_telecode != to_station_telecode_in THEN ITERATE lab_train_info_station; END if;                                     
					SET l_end_telecode = to_station_telecode_in;
			 END if;

			 INSERT INTO train_info_station VALUES (train_date_in,l_train_no,l_train_code,l_start_telecode,l_end_telecode);
			 
			 SET l_day_diff = l_end_day_difference - l_start_day_difference;
			 IF l_end_start_time < l_end_arrive_time THEN SET l_end_day_difference = l_end_day_difference - 1; end if;
			 SET l_day_diff = l_end_day_difference - l_start_day_difference;
			 IF l_day_diff < 0 THEN SET l_day_diff = 0; end if;

			 UPDATE temp_train_info_station SET day_diff = l_day_diff WHERE train_no = l_train_no AND flag = 1;

	END WHILE lab_train_info_station;


   if show_flag_in=9 then
	select * from train_info_station;
	
	select 'DQ40_left_station:call 	DS60_ticket_left',	'train_info_station'                           
	 , purpose_code_in
	 , inner_code_in
	 , range_in                                  
	 , 'A'                        
	 , 'tmp_ticket_left_station'                                                     
	 ,  0                                           
	 , show_flag_in,0,l_share_train_flag;
  end if;	 
        select _share_train_flag;
	CALL arith.DS60_ticket_left
		('train_info_station'                           
	 , purpose_code_in
	 , inner_code_in
	 , range_in                                  
	 , 'A'                        
	 , 'tmp_ticket_left_station'                                                     
	 ,  0                                           
	 , show_flag_in,0,l_share_train_flag)  ; 
 if show_flag_in=9 then
	
	SELECT * FROM tmp_ticket_left_station;
	select 'DQ40_left_station:end call 	DS60_ticket_left';
 end if;	 
	SET l_error =  @@error_count;
	IF l_error != 0 THEN leave lab_lab1; end if;

																																	
	IF l_left_new = 1 THEN
		 SET @l_SQL = concat('INSERT INTO temp_left_base_center_station SELECT train_no,train_date,"", station_no,assign_station '
			, ' ,far_from_station_no,limit_station,coach_no,seat_type_code,purpose_code,up_quantity,mid_quantity,down_quantity '
			, ' ,ticket_quantity,wseat_type_code,seat_feature,"" AS seat_type_name,"" AS purpose_name,0,0,"","","","","" '
			, ' FROM tmp_ticket_left_station ');
	ELSE
		 SET @l_SQL = concat('INSERT INTO temp_left_base_center_station SELECT train_no,train_date,"", station_no,assign_station '
			, ' ,far_from_station_no,limit_station,coach_no,seat_type_code,purpose_code,up_quantity,mid_quantity,down_quantity '
			, ' ,ticket_quantity,"","","","" ,0,0,"","","","","" '
			, ' FROM tmp_ticket_left_station ');
	END if;



	prepare stmt_1 from @l_SQL;
	EXECUTE stmt_1;
	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;


															 
	
	UPDATE temp_left_base_center_station a,temp_train_info_station b SET a.station_train_code = b.station_train_code
	 , a.start_time = b.start_time,a.assign_station = b.from_station
	 , a.day_diff = b.day_diff,a.arrive_time = b.end_arrive_time
	 , a.from_station = b.from_station,a.to_station = b.to_station
	 , a.to_station_no = b.to_station_no
		WHERE a.train_no = b.train_no;
	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;
	

											
	
	

	UPDATE temp_left_base_center_station a,basic.seat_type b SET a.seat_type_name = b.seat_type_name
		WHERE a.seat_type_code = b.seat_type_code and a.seat_type_code != 'W';

	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;

	UPDATE temp_left_base_center_station a,basic.seat_type b SET a.seat_type_name = 'ÎÞ×ù'
		WHERE a.seat_type_code = b.seat_type_code and a.seat_type_code = 'W';

	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;
	
										
	UPDATE temp_left_base_center_station SET seat_type_name = 'ÎÞ×ù'
	 WHERE seat_type_code = 'W';
	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;

	
									
	UPDATE temp_left_base_center_station a,basic.DG50_purpose_define b FORCE INDEX(purpose_define_idx) SET a.purpose_name = b.purpose_name
	 WHERE a.purpose_code = b.purpose_code;
	set l_error =  @@error_count,l_rowcount = row_count();
	IF l_error != 0 THEN leave lab_lab1; end if;
	

	INSERT INTO temp_left_station (train_no, train_date,  start_time, station_train_code, station_no,   assign, far_from_station_no
	 , far_from_station_name, limit_station_name, limit_station, coach_no,   seat_type_code,   seat_type_name, purpose_name
	 , up_quantity,  mid_quantity,  down_quantity, ticket_quantity, coach_num, arrive_time ,  share_flag, day_difference
	 , seat_feature , from_station , to_station , to_station_no )
	SELECT train_no,train_date,start_time,station_train_code,station_no,assign_station,far_from_station_no
	, '','',limit_station,coach_no,seat_type_code,seat_type_name,purpose_name
	, up_quantity,mid_quantity,down_quantity,ticket_quantity,0, arrive_time,share_flag,day_diff
	, seat_feature,from_station,to_station,to_station_no FROM temp_left_base_center_station;



	WHILE EXISTS(SELECT 1 FROM temp_left_station) DO
		 SELECT train_no into l_train_no 
			FROM temp_left_station
		 ORDER by start_time limit 1;

		
													 
		 SELECT DISTINCT train_no,train_date,start_time,station_train_code,station_no,from_station,to_station
			,seat_type_code,seat_type_name,purpose_name,sum(up_quantity) up_quantity,sum(mid_quantity) mid_quantity,sum(down_quantity) down_quantity
			,sum(ticket_quantity) ticket_quantity,sum(coach_num) coach_num,arrive_time,share_flag,day_difference,seat_feature
		 FROM temp_left_station 
			WHERE train_no = l_train_no
		 GROUP BY train_no,train_date,start_time,station_train_code,station_no,from_station,to_station,seat_type_code,seat_type_name,purpose_name
			,arrive_time,share_flag,day_difference,seat_feature;
		
		

		

		 DELETE FROM temp_left_station WHERE train_no = l_train_no;
	END WHILE;

	SET l_d2 = now();
							
	IF show_flag_in != 0 THEN
		 SET l_SQL =  concat('total time=',rtrim(CONVERT(timediff( l_d2,l_d1)/1000,char)),'.',rtrim(CONVERT(timediff( l_d2,l_d1)%1000,CHAR)),'s');
		 SELECT l_SQL;
	END if;

	LEAVE lab_lab1;

	set lab_lab1_s = 0;
	end loop lab_lab1;

	SET return_out=0;

if open_statistics='1' then
   set proc_stat_end =now();
   set proc_stat_time_diff = timestampdiff(SECOND,proc_stat_start,proc_stat_end);
   insert into proc_stat values('DQ40_left_station',proc_stat_start,proc_stat_end,proc_stat_time_diff);
 end if;
	COMMIT;
END ;;
DELIMITER ;
