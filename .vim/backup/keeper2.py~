#!/usr/bin/python
import os
import sys
import time
import atexit
import commands

file_pid= './sqlproxy.pid'

#log= open(file_log,'a')
print os.getpid()
try:
  pid=os.fork()
  print pid
  if pid >0 :
    sys.exit(0)
except OSError,e:
  sys.stderr.write("fork #1 failed:%d (%s)\n" % (e.errno,e.strerror))
  sys.exit(1)

while True:
    print pid,1
    time.sleep(1)
#sys.stdout.flush()
#sys.stderr.flush()
#si = file('/dev/null', 'r')
#so = file('/dev/null', 'a+')
#se = file('/dev/null', 'a+', 0)
#os.dup2(si.fileno(), sys.stdin.fileno())
#os.dup2(so.fileno(), sys.stdout.fileno())
#os.dup2(se.fileno(), sys.stderr.fileno())
#
#
#while True:
#  time.sleep(1)
#  if os.path.isfile(file_pid) == False:
#    os.system('./sqlproxy &')
#    a= 1;
#    while os.path.isfile(file_pid) == False :
#      time.sleep(1)
#      if a<10 :
#        a=a+1
#        continue
#      break
#
#    continue
#  
#  pro=commands.getoutput('ps -A | grep -c sqlproxy')
#  if pro == '0':
#    os.system('./sqlproxy &')
#    time.sleep(3)
#                        
