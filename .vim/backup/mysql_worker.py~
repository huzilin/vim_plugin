
import logging

from tornado.options import options

from utils.mail import send_mail
from .base_worker import BaseWorker
from opers.dba_opers import dba_opers


class CheckMysqlAlived(BaseWorker):

    def __init__(self, timeout=5):
        self.timeout = timeout

    def job(self):
        conn = db_opers.get_mysql_connection(options.mysql_host, options.mysql_user, options.mysql_passwd, options.mysql_port)
        if not conn:
            content = 'mysql %s, port %s are not connected' % (options.mysql_host, options.port)
            subject = 'mysql problem'
            send_mail(subject, content)
            logging.error(content)
        else:
            logging.info('connect mysql %s successful' % options.mysql_host) 
