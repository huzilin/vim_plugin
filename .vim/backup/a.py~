#!/usr/bin/python
import os,shutil
def get_myconf(data_home, port):
    myconf = data_home + '/' + str(port) + '/etc/my.cnf'
    return myconf

def prepare_recovery_env(data_home, port):
    recovery_port = 10000 + port
    src_conf = get_myconf(data_home, port)
    recovery_conf = get_myconf(data_home, recovery_port)
    if not os.path.exists(data_home + '/' + str(recovery_port)):
        os.system('mkdir -p ' + data_home + '/' +
                  str(recovery_port) + '/{data,logs,etc,tmp}')
        shutil.copy(src_conf, '/data/mysql/13306/etc/my.cnf')
        with open(recovery_conf, 'r+') as f:
            line = f.read()
            line.replace(str(port), str(recovery_port))
            f.write(line)

if __name__ == '__main__':
    prepare_recovery_env('/data/mysql',3306)
